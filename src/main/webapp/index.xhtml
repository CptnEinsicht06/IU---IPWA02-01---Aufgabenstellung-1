<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

<h:head>
    <title>CO₂-Emissionen – Übersicht</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        :root{
            --bg:#f6f4ea;        /* beige */
            --card:#ffffff;
            --text:#1f2937;      /* graublau dunkel */
            --muted:#475569;     /* slate-600 */
            --green:#2e7d32;     /* grün */
            --green-dark:#1b5e20;
            --green-soft:#a5d6a7; /* hellgrün */
            --border:#e5e7eb;
        }
        *{box-sizing:border-box}
        body{margin:0;background:var(--bg);color:var(--text);
            font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,Ubuntu,"Helvetica Neue",Arial,sans-serif;}

        /* Header */
        header{background:linear-gradient(135deg,#eaf6ea, #e8f3e0 60%); border-bottom:1px solid var(--border)}
        .container{max-width:1100px;margin:0 auto;padding:0 16px}
        .topbar{display:grid;grid-template-columns:auto 1fr;gap:16px;align-items:center;min-height:76px}
        .brand{display:flex;align-items:center;gap:12px;font-weight:700}
        .brand-title{font-size:18px;color:var(--green-dark)}

        /* Nav */
        nav{display:flex;gap:18px;align-items:center;justify-content:flex-start}
        nav a{color:var(--green-dark);text-decoration:none;font-weight:600;opacity:.9}
        nav a:hover{opacity:1;text-decoration:underline}

        /* Login rechts */
        .login-card{
            background:#ffffffaa;border:1px solid var(--border);border-radius:12px;padding:8px 10px;
            display:flex;gap:8px;align-items:center;
            box-shadow:0 6px 16px rgba(0,0,0,.06)
        }
        .login-card label{font-size:12px;color:var(--muted)}
        .login-card input{border:1px solid var(--border);border-radius:8px;padding:8px 10px;font-size:14px;min-width:150px}
        .btn{background:var(--green);color:#fff;border:none;border-radius:10px;padding:8px 12px;font-weight:600;cursor:pointer}
        .btn:hover{background:var(--green-dark)}

        .login-card { margin-left: 90px; }
        @media (max-width: 720px) {
            .login-card { margin-left: 0; } /* auf Handy wieder bündig */
        }

        /* Hero-Zeile unter Header */
        .hero{padding:14px 0 6px;color:var(--muted);font-size:14px}
        .text{padding:14px 0 6px;font-size:14px}

        /* Card + Tabelle */
        .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;margin:16px 0;
            box-shadow:0 10px 24px rgba(0,0,0,.06)}
        .meta{display:flex;gap:18px;flex-wrap:wrap;color:var(--muted);font-size:14px;margin:0 0 10px}
        table{width:100%;border-collapse:collapse}
        th,td{padding:10px 12px; border-bottom:1px solid var(--border); vertical-align:top; text-align:left;}
        th{font-size:12px;text-transform:uppercase;letter-spacing:.04em;color:#0f5132}
        td{font-size:14px}
        tbody tr:hover{background:#f3faf3}
        .sortable a{color:inherit;text-decoration:none}
        .arrow{color:var(--green-dark)}

        /* Footer */
        footer{color:#64748b;font-size:12px;padding:18px 0 32px}
        @media (max-width:720px){ .topbar{grid-template-columns:1fr;gap:10px} .login-card{flex-wrap:wrap;justify-content:space-between} }

        /* Header und Footer in dunkelgrün */
        :root { --header-green: #206a2b; }   /* etwas dunkler als dein aktuelles Grün */
        header{
            background: var(--header-green);   /* statt des hellen Verlaufs */
            border-bottom: none;
        }
        header .brand-title{ color:#fff; }
        header a, header nav a{ color:#fff; opacity:1; text-decoration:none; }
        header nav a:hover{ text-decoration:underline; color:#fff; }

        footer{
            background: var(--header-green);
            color:#fff; border-top:none;
        }
        footer a{ color:#fff; text-decoration:underline; }
    </style>
</h:head>

<h:body>

    <!-- Header mit Logo, Nav und Login -->
    <header>
        <div class="container">
            <div class="topbar">
                <!-- Logo & Titel -->
                <div class="brand">
                    <h:graphicImage value="Logo.png" width="60" alt="Logo"/>
                    <div class="brand-title">From Zero To Hero · CO₂-Emissionen</div>
                </div>

                <!-- Login oben rechts -->
                <h:form id="loginForm" prependId="false">
                    <div class="login-card">
                        <div>
                            <label for="user">Benutzer</label><br/>
                            <h:inputText id="user" value="#{loginUser.username}" required="true"/>
                        </div>
                        <div>
                            <label for="pass">Passwort</label><br/>
                            <h:inputSecret id="pass" value="#{loginUser.password}" required="true"/>
                        </div>
                        <div style="align-self:end">
                            <!-- nur diese Zeile geändert: login → loginNavigate -->
                            <h:commandButton styleClass="btn" value="Login" action="#{loginUser.loginNavigate}"/>
                        </div>
                    </div>
                    <h:outputText value="#{loginUser.loginErrorMsg}"
                                  style="color:#b91c1c;margin-top:6px;display:block"/>
                </h:form>

            </div>
        </div>
    </header>

    <!-- Inhalt: Fehlermeldung oder Tabelle -->
    <div class="container">
        <h:messages globalOnly="true"/>

        <h:panelGroup rendered="#{not empty emissionBean.error}">
            <div class="card" style="border-color:#fca5a5;background:#fff5f5">
                <b style="color:#b91c1c">Fehler:</b> #{emissionBean.error}
            </div>
        </h:panelGroup>

        <div class="text">
            <p style="margin:0">
                Logindaten für Datenanpassung:<br/>
                Benutzer: wissenschaftler | wissenschaftlerin<br/>
                Passwort: wissen
            </p>
            <p>
                Logindaten für Administration:<br/>
                Benutzer: admin<br/>
                Passwort: admin
            </p>
            <p>Über diese Tabelle: Sie zeigt CO₂-Emissionen von 266 Ländern und Regionen. Für jedes Land sind die Mengen in Kilotonnen (kt) für die Jahre 1990, 2000, 2010 und 2020 aufgeführt. Standardmäßig ist nach der ID sortiert; durch Klick auf eine Spaltenüberschrift kannst du auf- und absteigend sortieren. Das Suchfeld filtert nach Ländernamen. Leere Felder bedeuten, dass für das jeweilige Jahr keine verlässlichen Angaben vorlagen. </p>
            <p>Datenquelle: Die Zahlen kommen aus der World Bank Open Data Reihe „CO₂ emissions (kt)“ und wurden für dieses Projekt aufbereitet. Die Einheit kt entspricht 1 000 Tonnen CO₂. Je nach Datenerfassung und Rundung können kleine Abweichungen auftreten; die Werte dienen daher vor allem dem Vergleich über Länder und Zeit.</p>
            <p>Mitarbeit und Qualitätssicherung: Registrierte Wissenschaftler:innen können neue Werte oder Korrekturen für 1990/2000/2010/2020 vorschlagen. Jeder Vorschlag wird von der Administration geprüft und entweder freigegeben (Übernahme in die Datenbank) oder abgelehnt. So bleiben die Daten offen, nachvollziehbar und verlässlich.</p>
        </div>


        <h:form id="tableForm" prependId="false" rendered="#{empty emissionBean.error}">
            <div class="card">
                <div class="meta">
                    <div>Gesamtzeilen: <b>#{emissionBean.total}</b></div>
                </div>

                <!-- SUCHLEISTE: nur Land, Treffer kommen nach oben -->
                <div style="margin:8px 0;">
                    <input id="searchLand" type="text" placeholder="Land suchen …"
                           oninput="applyLandSearch()"
                           style="padding:6px 10px; border-radius:8px; border:1px solid #e5e7eb; width:260px;" />
                    <button type="button" onclick="document.getElementById('searchLand').value=''; applyLandSearch();"
                            style="margin-left:6px; padding:6px 10px; border-radius:8px; border:1px solid #e5e7eb; background:#f8fafc; cursor:pointer;">
                        Zurücksetzen
                    </button>
                </div>


                <!-- TABELLE (ID hinzugefügt) -->
                <h:dataTable id="emissionTable" value="#{emissionBean.rows}" var="r" rendered="#{emissionBean.total gt 0}">
                    <!-- ID -->
                    <h:column>
                        <f:facet name="header">
                            <span class="sortable">
                                <h:commandLink action="#{emissionBean.sort('id')}" value="ID#{emissionBean.ind('id')}" immediate="true">
                                    <f:ajax render="@form"/>
                                </h:commandLink>
                            </span>
                        </f:facet>
                        #{r.id}
                    </h:column>

                    <!-- Land -->
                    <h:column>
                        <f:facet name="header">
                            <span class="sortable">
                                <h:commandLink action="#{emissionBean.sort('land')}" value="Land#{emissionBean.ind('land')}" immediate="true">
                                    <f:ajax render="@form"/>
                                </h:commandLink>
                            </span>
                        </f:facet>
                        #{r.land}
                    </h:column>

                    <!-- Landcode -->
                    <h:column>
                        <f:facet name="header">
                            <span class="sortable">
                                <h:commandLink action="#{emissionBean.sort('landcode')}" value="Landcode#{emissionBean.ind('landcode')}" immediate="true">
                                    <f:ajax render="@form"/>
                                </h:commandLink>
                            </span>
                        </f:facet>
                        #{r.landCode}
                    </h:column>

                    <!-- Emission 1990 -->
                    <h:column>
                        <f:facet name="header">
                            <span class="sortable">
                                <h:commandLink action="#{emissionBean.sort('emission1990')}" value="Emissionen 1990 in kt#{emissionBean.ind('emission1990')}" immediate="true">
                                    <f:ajax render="@form"/>
                                </h:commandLink>
                            </span>
                        </f:facet>
                        #{r.emission1990}
                    </h:column>

                    <!-- Emission 2000 -->
                    <h:column>
                        <f:facet name="header">
                            <span class="sortable">
                                <h:commandLink action="#{emissionBean.sort('emission2000')}" value="Emissionen 2000 in kt#{emissionBean.ind('emission2000')}" immediate="true">
                                    <f:ajax render="@form"/>
                                </h:commandLink>
                            </span>
                        </f:facet>
                        #{r.emission2000}
                    </h:column>

                    <!-- Emission 2010 -->
                    <h:column>
                        <f:facet name="header">
                            <span class="sortable">
                                <h:commandLink action="#{emissionBean.sort('emission2010')}" value="Emissionen 2010 in kt#{emissionBean.ind('emission2010')}" immediate="true">
                                    <f:ajax render="@form"/>
                                </h:commandLink>
                            </span>
                        </f:facet>
                        #{r.emission2010}
                    </h:column>

                    <!-- Emission 2020 -->
                    <h:column>
                        <f:facet name="header">
                            <span class="sortable">
                                <h:commandLink action="#{emissionBean.sort('emission2020')}" value="Emissionen 2020 in kt#{emissionBean.ind('emission2020')}" immediate="true">
                                    <f:ajax render="@form"/>
                                </h:commandLink>
                            </span>
                        </f:facet>
                        #{r.emission2020}
                    </h:column>
                </h:dataTable>

                <h:panelGroup rendered="#{emissionBean.total == 0}">
                    <div style="color:#64748b">Keine Daten gefunden. Prüfe Schema <b>emission</b> und Tabelle <b>emissionen</b>.</div>
                </h:panelGroup>
            </div>
        </h:form>
    </div>

    <footer>
        <div class="container">
            © Dennis Schloss - Matrikelnummer: 32110836 ·
            <a href="imprint.html">Impressum</a> · <a href="privacy.html">Datenschutz</a>
        </div>
    </footer>

    <!-- JS: Suchtext sortiert Zeilen so, dass passende Länder oben stehen -->
    <script type="text/javascript">
        //<![CDATA[
        (function() {
            function table() {
                return document.getElementById('emissionTable')
                    || document.querySelector('table[id$="emissionTable"]'); // fallback bei JSF-ClientIDs
            }
            function tbody() { var t = table(); return t && t.tBodies && t.tBodies[0] ? t.tBodies[0] : null; }

            function initOriginalOrder() {
                var tb = tbody(); if (!tb) return;
                var rows = tb.rows;
                for (var i = 0; i < rows.length; i++) rows[i].setAttribute('data-orig-index', String(i));
            }

            function scoreRowByLand(row, filter) {
                var landCell = row.cells && row.cells[1] ? row.cells[1].textContent.toLowerCase() : '';
                if (!filter) return 0;
                if (landCell === filter) return 3;
                if (landCell.indexOf(filter) === 0) return 2;
                if (landCell.indexOf(filter) > -1) return 1;
                return 0;
            }

            function applyLandSearch() {
                var qEl = document.getElementById('searchLand');
                var q = (qEl && qEl.value ? qEl.value : '').trim().toLowerCase();
                var tb = tbody(); if (!tb) return;

                var rows = Array.prototype.slice.call(tb.rows);
                rows.sort(function(a, b) {
                    var sa = scoreRowByLand(a, q), sb = scoreRowByLand(b, q);
                    if (sb !== sa) return sb - sa; // Treffer zuerst
                    var oa = parseInt(a.getAttribute('data-orig-index') || '0', 10);
                    var ob = parseInt(b.getAttribute('data-orig-index') || '0', 10);
                    return oa - ob; // stabil
                });
                for (var i = 0; i < rows.length; i++) tb.appendChild(rows[i]);
            }

            window.applyLandSearch = applyLandSearch;

            window.addEventListener('load', function() { initOriginalOrder(); });

            if (window.jsf && jsf.ajax) {
                jsf.ajax.addOnEvent(function(data) {
                    if (data && data.status === 'success') { initOriginalOrder(); applyLandSearch(); }
                });
            }
        })();
        //]]>
    </script>

</h:body>
</html>


